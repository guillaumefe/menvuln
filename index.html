<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ENVULN — Threat Path Explorer</title>
  <link rel="stylesheet" href="./styles/app.css">
</head>

<body>
<div class="wrap">

  <!-- LEFT PANEL — Add + Manage Entities -->
  <div class="panel" id="panelEntities">
    <h3>Ajout & Gestion</h3>
    <div class="small">Ajouter, renommer ou supprimer les entités ici.</div>

    <!-- Add forms -->
    <div class="form-block">
      <label>Nouvel attaquant</label>
      <div class="row">
        <input id="attackerName" placeholder="Nom attaquant">
        <button id="btnAddAttacker">Ajouter</button>
      </div>
    </div>

    <div class="form-block">
      <label>Nouvelle cible</label>
      <div class="row">
        <input id="targetName" placeholder="Nom cible">
        <button id="btnAddTarget">Ajouter</button>
      </div>
    </div>

    <div class="form-block">
      <label>Nouvelle vulnérabilité</label>
      <div class="row">
        <input id="vulnName" placeholder="Nom vulnérabilité">
        <button id="btnAddVuln">Ajouter</button>
      </div>
    </div>

    <hr>

    <!-- Entity Lists -->
    <h3>Attaquants</h3>
    <div id="attackerList" class="list"></div>

    <h3>Cibles de l'attaquant</h3>
    <div id="targetList" class="list"></div>

    <h3>Vulnérabilités</h3>
    <div id="vulnList" class="list"></div>
  </div>

  <!-- CENTER PANEL — Associations / Compute / Results -->
  <div class="panel" id="panelAssociations">
    <h3>Configuration & Exploration</h3>

    <div class="row">
      <div class="col">
        <label>Attaquant courant</label>
        <select id="selAttacker"></select>
      </div>
      <div class="col speed-col">
        <label for="simSpeed">Vitesse simulation</label>
        <input id="simSpeed" type="range" min="0.2" max="3" step="0.1" value="1">
        <span id="simSpeedValue">×1.0</span>
      </div>
    </div>

    <div class="row ceiling-row">
      <label for="maxPaths">Limite de chemins</label>
      <input type="number" id="maxPaths" min="100" value="2000">
    </div>

    <hr>

    <!-- NEW: Entry points selection (before vuln association) -->
    <h3>Point d'entrée de l'attaquant</h3>
    <div class="small">Sélectionne les éléments (cibles) qui serviront de points d'entrée pour l'attaquant.</div>
    <div class="row">
      <!-- ce select doit être rempli côté JS avec la liste des cibles -->
      <select id="selEntriesAll" multiple size="6"></select>
    </div>
    <div class="row">
      <button id="btnSetEntries">Appliquer points d'entrée</button>
      <button id="btnClearEntries" class="ghost">Effacer sélection</button>
      <span id="entriesStatus" class="small">—</span>
    </div>

    <hr>

    <!-- Vulnerability association (separate selector + vuln selection) -->
    <h3>Vulnérabilités</h3>
    <div class="small">Choisis un élément, puis sélectionne/désélectionne les vulnérabilités à lui associer.</div>

    <div class="row">
      <div class="col">
        <label>Élément à éditer</label>
        <!-- selector permettant de choisir l'élément (ex : une cible) qui recevra les vulnérabilités -->
        <select id="selVulnElement">
          <!-- rempli par JS : options (targets, éventuellement attackers selon besoin) -->
        </select>
      </div>

      <div class="col">
        <label>Vulnérabilités (multi)</label>
        <select id="selVulnsForElement" multiple size="6"></select>
      </div>
    </div>

    <div class="row">
      <button id="btnAttachVulns">Associer vulnérabilités</button>
      <button id="btnDetachVulns" class="ghost">Dissocier vulnérabilités</button>
      <span class="small" id="assocStatus">Sélectionnez un élément et des vulnérabilités.</span>
    </div>

    <hr>

    <!-- Links -->
    <h3>Liens entre cibles</h3>
    <div class="row">
      <select id="linkSource"></select>
      <select id="linkDest" multiple size="4"></select>
      <select id="linkType">
        <option value="direct">direct</option>
        <option value="lateral">latéral</option>
        <option value="contains">contient</option>
      </select>
    </div>

    <div class="row">
      <button id="btnAddLink">Ajouter lien</button>
      <button id="btnRemoveLink" class="ghost">Supprimer lien</button>
      <label><input type="checkbox" id="includeLateral" checked> inclure latéral</label>
      <label><input type="checkbox" id="includeContains" checked> inclure contient</label>
    </div>

    <div id="linksInspector" class="small"></div>

    <hr>

    <!-- Actions -->
    <div class="row top-actions">
      <button id="btnFindPaths">Calculer chemins</button>
      <button id="btnExportODS" class="ghost">Export ODS</button>
      <button id="btnImportJSON" class="ghost">Import JSON</button>
      <button id="btnExportJSON" class="ghost">Export JSON</button>
      <button id="btnSimu" class="ghost">Simulation</button>
      <input type="file" id="fileIn" accept="application/json" hidden>
      <span id="status" class="small">—</span>
    </div>

    <hr>

    <!-- Results -->
    <h3 style="display:flex;align-items:center;gap:10px">
      Résultats
      <label class="small" style="display:inline-flex;align-items:center;gap:6px">
        <input type="checkbox" id="chkOnlyVuln">
        Chemins vulnérables uniquement
      </label>
    </h3>

    <div id="results" class="path-list"></div>
  </div>

  <!-- RIGHT PANEL — Tutorial + Diagram -->
  <div class="panel" id="panelDetailsRight">
    <h3>Tutoriel</h3>
    <ol id="tutorial" class="small"></ol>

    <hr>

    <h3>Diagramme d’attaque</h3>
    <div id="diagramBox" class="uml"><div class="small">Sélectionne un chemin → Diagramme</div></div>

    <div class="row">
      <button id="btnDownloadSVG" class="ghost">Télécharger SVG</button>
      <span id="svgSize" class="small">—</span>
    </div>
  </div>

</div>

<script type="module" src="./js/main.js"></script>
</body>
</html>
