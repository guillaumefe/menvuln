<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ENVULN — Threat Path Explorer</title>
  <link rel="stylesheet" href="./styles/app.css">
</head>

<body>
<div class="wrap">

  <!-- LEFT: Add-only -->
  <div class="panel" id="panelEntities">
    <h3>Resources (Add only)</h3>

    <div class="form-block">
      <label>New attacker</label>
      <div class="row">
        <input id="attackerName" placeholder="Attacker name">
        <button id="btnAddAttacker">Add</button>
      </div>
    </div>

    <div class="form-block">
      <label>New target</label>
      <div class="row">
        <input id="targetName" placeholder="Target name">
        <button id="btnAddTarget">Add</button>
      </div>
    </div>

    <div class="form-block">
      <label>New vulnerability</label>
      <div class="row">
        <input id="vulnName" placeholder="Vulnerability name">
        <button id="btnAddVuln">Add</button>
      </div>
    </div>

    <hr>
    <div class="small">
      The lists and associations are in the center panel.
    </div>
  </div>

  <!-- CENTER: Entries → Exits → Targets → Details → Vuln Assoc → Links → Results -->
  <div class="panel" id="panelAssociations">
    <h3>Associations & compute</h3>

    <div class="row">
      <div class="col">
        <label>Current attacker</label>
        <select id="selAttacker"></select>
      </div>
      <div class="col speed-col">
        <label for="simSpeed">Simulation speed</label>
        <input id="simSpeed" type="range" min="0.2" max="3" step="0.1" value="1">
        <span id="simSpeedValue">×1.0</span>
      </div>
    </div>

    <label>Attacker entry points (multi)</label>
    <select multiple id="selEntriesAll" size="6"></select>

    <label>Attacker exit points (multi)</label>
    <select multiple id="selExitsAll" size="6"></select>

    <div class="row ceiling-row">
      <label for="maxPaths">Path ceiling</label>
      <input type="number" id="maxPaths" min="100" value="2000">
    </div>

    <hr>

    <h3>Targets</h3>
    <div id="targetList" class="list"></div>

    <h3>Details / editor</h3>
    <div id="details" class="col small">Select a target or attacker.</div>

    <hr>

    <!-- NEW: Vulnerability association BEFORE link creation -->
    <h3>Vulnerabilities association</h3>
    <div class="row">
      <div class="col">
        <label>Target</label>
        <select id="selTargetAssoc"></select>
      </div>
      <div class="col">
        <label>Vulnerabilities (multi)</label>
        <select id="selVulnsAssoc" multiple size="6"></select>
      </div>
    </div>

    <div class="row">
      <button id="btnAttachVulns">Attach vulnerabilities</button>
      <button id="btnDetachVulns" class="ghost">Detach vulnerabilities</button>
      <span class="small" id="assocStatus">Pick a target and some vulnerabilities.</span>
    </div>

    <hr>

    <h3>Target links</h3>
    <div class="row">
      <select id="linkSource"></select>
      <select id="linkDest" multiple size="4"></select>
      <select id="linkType">
        <option value="direct">direct</option>
        <option value="lateral">lateral</option>
        <option value="contains">contains</option>
      </select>
    </div>

    <div class="row">
      <button id="btnAddLink">Add link</button>
      <button id="btnRemoveLink" class="ghost">Remove link</button>
      <label><input type="checkbox" id="includeLateral" checked> include lateral</label>
      <label><input type="checkbox" id="includeContains" checked> include contains</label>
    </div>

    <div id="linksInspector" class="small"></div>

    <hr>

    <div class="row top-actions">
      <button id="btnFindPaths">Compute paths</button>
      <button id="btnExportODS" class="ghost">Export ODS</button>
      <button id="btnImportJSON" class="ghost">Import JSON</button>
      <button id="btnExportJSON" class="ghost">Export JSON</button>
      <button id="btnSimu" class="ghost">Simulation</button>
      <input type="file" id="fileIn" accept="application/json" hidden>
      <span id="status" class="small">—</span>
    </div>

    <hr>

    <h3 style="display:flex;align-items:center;gap:10px">
      Results
      <label class="small" style="display:inline-flex;align-items:center;gap:6px">
        <input type="checkbox" id="chkOnlyVuln">
        Only paths with vulns
      </label>
    </h3>

    <div id="results" class="path-list"></div>
  </div>

  <!-- RIGHT: only Tutorial + Diagram -->
  <div class="panel" id="panelDetailsRight">
    <h3>Tutorial</h3>
    <ol id="tutorial" class="small"></ol>

    <hr>

    <h3>Attack diagram</h3>
    <div id="diagramBox" class="uml"><div class="small">Pick a path → Diagram</div></div>

    <div class="row">
      <button id="btnDownloadSVG" class="ghost">Download SVG</button>
      <span id="svgSize" class="small">—</span>
    </div>
  </div>

</div>

<script type="module" src="./js/main.js"></script>
</body>
</html>
