<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ENVULN — Threat Path Explorer</title>
  <link rel="stylesheet" href="./styles/app.css">
</head>

<body>
<div class="wrap">

  <!-- LEFT PANEL — Add + Manage Entities -->
  <div class="panel" id="panelEntities">
    <h3>Add & Manage</h3>
    <div class="small">Add, rename, or delete entities here.</div>

    <!-- Add forms -->
    <div class="form-block">
      <label>New attacker</label>
      <div class="row">
        <input id="attackerName" placeholder="Attacker name">
        <button id="btnAddAttacker">Add</button>
      </div>
    </div>

    <div class="form-block">
      <label>New target</label>
      <div class="row">
        <input id="targetName" placeholder="Target name">
        <button id="btnAddTarget">Add</button>
      </div>
    </div>

    <div class="form-block">
      <label>New vulnerability</label>
      <div class="row">
        <input id="vulnName" placeholder="Vulnerability name">
        <button id="btnAddVuln">Add</button>
      </div>
    </div>

    <hr>

    <!-- Entity Lists -->
    <h3>Attackers</h3>
    <div id="attackerList" class="list"></div>

    <h3>Attacker targets</h3>
    <div id="targetList" class="list"></div>

    <h3>Vulnerabilities</h3>
    <div id="vulnList" class="list"></div>
  </div>

  <!-- CENTER PANEL — Associations / Compute / Results -->
  <div class="panel" id="panelAssociations">
    <h3>Configuration & Exploration</h3>

    <div class="row ceiling-row">
      <!-- (Simulation speed and Path limit were moved to the right panel as requested) -->
    </div>

    <hr>

    <!-- NEW: Attacker selection (placed above entry points as requested) -->
    <h3>Attacker selection</h3>
    <div class="small">Choose the current attacker.</div>
    <div class="row">
      <select id="selAttacker"></select>
    </div>

    <hr>

    <!-- NEW: Entry points selection (before vuln association) -->
    <h3>Attacker entry point</h3>
    <div class="small">Select the elements (targets) that will serve as entry points for the attacker.</div>
    <div class="row">
      <!-- this select must be filled in JS with the list of targets -->
      <select id="selEntriesAll" multiple size="6"></select>
    </div>
    <div class="row">
      <button id="btnSetEntries">Apply entry points</button>
      <button id="btnClearEntries" class="ghost">Clear selection</button>
      <span id="entriesStatus" class="small">—</span>
    </div>

    <hr>

    <!-- NEW: Exit points selection (just under entry points, as requested) -->
    <h3>Attacker exit point</h3>
    <div class="small">Select the elements (targets) that will serve as exit points for the attacker.</div>
    <div class="row">
      <!-- this select must be filled in JS with the list of targets -->
      <select id="selExitsAll" multiple size="6"></select>
    </div>
    <div class="row">
      <button id="btnSetExits">Apply exit points</button>
      <button id="btnClearExits" class="ghost">Clear selection</button>
      <span id="exitsStatus" class="small">—</span>
    </div>

    <hr>

    <!-- Vulnerability association (separate selector + vuln selection) -->
    <h3>Vulnerabilities</h3>
    <div class="small">Choose an item, then select/deselect the vulnerabilities to associate with it.</div>

    <div class="row">
      <div class="col">
        <label>Item to edit</label>
        <!-- selector to choose the item (e.g., a target) that will receive vulnerabilities -->
        <select id="selVulnElement">
          <!-- filled by JS: options (targets, possibly attackers as needed) -->
        </select>
      </div>

      <div class="col">
        <label>Vulnerabilities (multi)</label>
        <select id="selVulnsForElement" multiple size="6"></select>
      </div>
    </div>

    <div class="row">
      <button id="btnAttachVulns">Attach vulnerabilities</button>
      <button id="btnDetachVulns" class="ghost">Detach vulnerabilities</button>
      <span class="small" id="assocStatus">Select an item and vulnerabilities.</span>
    </div>

    <hr>

    <!-- Links -->
    <h3>Links between targets</h3>
    <div class="row">
      <select id="linkSource"></select>
      <select id="linkDest" multiple size="4"></select>
      <select id="linkType">
        <option value="direct">direct</option>
        <option value="lateral">lateral</option>
        <option value="contains">contains</option>
      </select>
    </div>

    <div class="row">
      <button id="btnAddLink">Add link</button>
      <button id="btnRemoveLink" class="ghost">Remove link</button>
      <label><input type="checkbox" id="includeLateral" checked> include lateral</label>
      <label><input type="checkbox" id="includeContains" checked> include contains</label>
    </div>

    <div id="linksInspector" class="small"></div>

    <hr>

    <!-- Actions -->
    <div class="row top-actions">
      <button id="btnFindPaths">Compute paths</button>
      <button id="btnExportODS" class="ghost">Export ODS</button>
      <button id="btnImportJSON" class="ghost">Import JSON</button>
      <button id="btnExportJSON" class="ghost">Export JSON</button>
      <button id="btnSimu" class="ghost">Simulation</button>
      <input type="file" id="fileIn" accept="application/json" hidden>
      <span id="status" class="small">—</span>
    </div>

    <hr>

    <!-- Results -->
    <h3 style="display:flex;align-items:center;gap:10px">
      Results
      <label class="small" style="display:inline-flex;align-items:center;gap:6px">
        <input type="checkbox" id="chkOnlyVuln">
        Vulnerable paths only
      </label>
    </h3>

    <div id="results" class="path-list"></div>
  </div>

  <!-- RIGHT PANEL — Tutorial + Configuration + Diagram -->
  <div class="panel" id="panelDetailsRight">
    <h3>Tutorial</h3>
    <ol id="tutorial" class="small"></ol>

    <hr>

    <!-- MOVED: Configuration (Simulation speed & Path limit) -->
    <h3>Configuration</h3>
    <div class="row">
      <div class="col speed-col">
        <label for="simSpeed">Simulation speed</label>
        <input id="simSpeed" type="range" min="0.2" max="3" step="0.1" value="1">
        <span id="simSpeedValue">×1.0</span>
      </div>
    </div>

    <div class="row ceiling-row">
      <label for="maxPaths">Path limit</label>
      <input type="number" id="maxPaths" min="100" value="2000">
    </div>

    <hr>

    <h3>Attack diagram</h3>
    <div id="diagramBox" class="uml"><div class="small">Select a path → Diagram</div></div>

    <div class="row">
      <button id="btnDownloadSVG" class="ghost">Download SVG</button>
      <span id="svgSize" class="small">—</span>
    </div>
  </div>

</div>

<script type="module" src="./js/main.js"></script>
</body>
</html>
