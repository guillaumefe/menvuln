<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ENVULN — Threat Path Explorer</title>
  <link rel="stylesheet" href="./styles/app.css">
</head>

<body>
<div class="wrap">

  <!-- LEFT: Add + Lists (edit/delete) -->
  <div class="panel" id="panelEntities">
    <h3>Ajout & Éléments</h3>
    <div class="small">Crée les entités ici. Les listes ci-dessous permettent de renommer ou supprimer.</div>

    <!-- Add forms -->
    <div class="form-block">
      <label>Nouvel attaquant</label>
      <div class="row">
        <input id="attackerName" placeholder="Nom attaquant">
        <button id="btnAddAttacker">Ajouter</button>
      </div>
    </div>

    <div class="form-block">
      <label>Nouvelle cible</label>
      <div class="row">
        <input id="targetName" placeholder="Nom cible">
        <button id="btnAddTarget">Ajouter</button>
      </div>
    </div>

    <div class="form-block">
      <label>Nouvelle vulnérabilité</label>
      <div class="row">
        <input id="vulnName" placeholder="Nom vulnérabilité">
        <button id="btnAddVuln">Ajouter</button>
      </div>
    </div>

    <hr>

    <!-- Lists with inline edit/delete -->
    <h3>Attaquants</h3>
    <div id="attackerList" class="list">
      <!--
        Chaque item injecté par JS doit ressembler à :
        <div class="list-item">
          <span class="item-name">Attacker A</span>
          <div class="item-actions">
            <button class="btn-rename" data-type="attacker" data-id="...">Rename</button>
            <button class="btn-delete ghost" data-type="attacker" data-id="...">Delete</button>
          </div>
        </div>
      -->
    </div>

    <h3>Cibles</h3>
    <div id="targetList" class="list"></div>

    <h3>Vulnérabilités</h3>
    <div id="vulnList" class="list"></div>
  </div>

  <!-- CENTER: Compute, associations, links, results -->
  <div class="panel" id="panelAssociations">
    <h3>Configuration & Calcul</h3>

    <div class="row">
      <div class="col">
        <label>Attaquant courant</label>
        <select id="selAttacker"></select>
      </div>
      <div class="col speed-col">
        <label for="simSpeed">Vitesse simulation</label>
        <input id="simSpeed" type="range" min="0.2" max="3" step="0.1" value="1">
        <span id="simSpeedValue">×1.0</span>
      </div>
    </div>

    <div class="row ceiling-row">
      <label for="maxPaths">Limite de chemins</label>
      <input type="number" id="maxPaths" min="100" value="2000">
    </div>

    <hr>

    <!-- IMPORTANT: le bloc "Détails / Édition" + "Entry points" + "Exit points" A ÉTÉ SUPPRIMÉ -->

    <h3>Association des vulnérabilités</h3>
    <div class="row">
      <div class="col">
        <label>Cible</label>
        <select id="selTargetAssoc"></select>
      </div>
      <div class="col">
        <label>Vulnérabilités (multi)</label>
        <select id="selVulnsAssoc" multiple size="6"></select>
      </div>
    </div>

    <div class="row">
      <button id="btnAttachVulns">Associer</button>
      <button id="btnDetachVulns" class="ghost">Dissocier</button>
      <span class="small" id="assocStatus">Choisissez une cible et des vulnérabilités.</span>
    </div>

    <hr>

    <h3>Liens entre cibles</h3>
    <div class="row">
      <select id="linkSource"></select>
      <select id="linkDest" multiple size="4"></select>
      <select id="linkType">
        <option value="direct">direct</option>
        <option value="lateral">latéral</option>
        <option value="contains">contient</option>
      </select>
    </div>

    <div class="row">
      <button id="btnAddLink">Ajouter lien</button>
      <button id="btnRemoveLink" class="ghost">Supprimer lien</button>
      <label><input type="checkbox" id="includeLateral" checked> inclure latéral</label>
      <label><input type="checkbox" id="includeContains" checked> inclure contient</label>
    </div>

    <div id="linksInspector" class="small"></div>

    <hr>

    <div class="row top-actions">
      <button id="btnFindPaths">Calculer chemins</button>
      <button id="btnExportODS" class="ghost">Export ODS</button>
      <button id="btnImportJSON" class="ghost">Import JSON</button>
      <button id="btnExportJSON" class="ghost">Export JSON</button>
      <button id="btnSimu" class="ghost">Simulation</button>
      <input type="file" id="fileIn" accept="application/json" hidden>
      <span id="status" class="small">—</span>
    </div>

    <hr>

    <h3 style="display:flex;align-items:center;gap:10px">
      Résultats
      <label class="small" style="display:inline-flex;align-items:center;gap:6px">
        <input type="checkbox" id="chkOnlyVuln">
        Chemins vulnérables uniquement
      </label>
    </h3>

    <div id="results" class="path-list"></div>
  </div>

  <!-- RIGHT: Tutorial + Diagram -->
  <div class="panel" id="panelDetailsRight">
    <h3>Tutoriel</h3>
    <ol id="tutorial" class="small"></ol>

    <hr>

    <h3>Diagramme d’attaque</h3>
    <div id="diagramBox" class="uml"><div class="small">Choisis un chemin → Diagramme</div></div>

    <div class="row">
      <button id="btnDownloadSVG" class="ghost">Télécharger SVG</button>
      <span id="svgSize" class="small">—</span>
    </div>
  </div>

</div>

<script type="module" src="./js/main.js"></script>
</body>
</html>
